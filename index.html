<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚Ñ¢Ô∏èHitster Card Generator</title>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
  body { 
	font-family: Arial, sans-serif; 
	margin: 0; 
	padding: 10px; 
	background: linear-gradient(135deg, #121212 0%, #1DB954 100%); 
	color: #fff;
	background-repeat: no-repeat;
	background-attachment: fixed;
	background-size: cover;
	min-height: 100vh;
  }
  
  
  h1 { text-align: center; margin-top: 0; }
  .input-row { margin-bottom: 10px; display: flex; gap: 10px; }
  input[type="text"] { width: 100%; padding: 5px; }
  button { padding: 8px 16px; margin-top: 10px; cursor: pointer; }


  
  #clientId, #clientSecret {
  display: block;
  width: calc(100% - 10px);
  box-sizing: border-box;
  }
  
  #cards, 
	#cards .info, 
	#cards .year, 
	#cards .artist, 
	#cards .title {
	  color: #000;
    }
  
  #cards { 
    display: grid;
    grid-template-rows: repeat(6, 1fr);
    width: 210mm; 
    margin: 0 auto;
    box-sizing: border-box;
  }

  .card {
    display: flex; 
    align-items: center; 
    justify-content: flex-start;
    border-bottom: 1px solid #ccc;
    padding: 5mm 8mm;
    height: 46mm;
    box-sizing: border-box;
    page-break-inside: avoid;
  }

  .qr {
    width: 32mm; 
    height: 32mm; 
    flex-shrink: 0;
  }

  .info {
    margin-left: 12mm;
    text-align: center;
    width: 100%;
  }

  /* Bet≈±m√©retek */
  .info .year {
    font-size: 20pt;
    font-weight: bold;
  }

  .info .artist, .info .title {
    font-size: 16pt;
    font-weight: normal;
  }

  @media print {
    body { margin: 0; }
    #cards { border: none; }
  }
  
  .button-container {
    display: flex;
    justify-content: center; 
    gap: 15px; 
    margin-top: 15px;
    margin-bottom: 15px;
  }
  
  
</style>
</head>
<body>
<h1>üéµ Hitster Card Generator üéµ</h1>

<label>Spotify Client ID:</label>
<input type="text" id="clientId" placeholder="Client ID" style="width:100%;margin-bottom:5px;">
<label>Spotify Client Secret:</label>
<input type="text" id="clientSecret" placeholder="Client Secret" style="width:100%;margin-bottom:10px;">

<div id="links">
  <div class="input-row"><input type="text" placeholder="Spotify track link #1"></div>
  <div class="input-row"><input type="text" placeholder="Spotify track link #2"></div>
  <div class="input-row"><input type="text" placeholder="Spotify track link #3"></div>
  <div class="input-row"><input type="text" placeholder="Spotify track link #4"></div>
  <div class="input-row"><input type="text" placeholder="Spotify track link #5"></div>
  <div class="input-row"><input type="text" placeholder="Spotify track link #6"></div>
</div>


<div class="button-container">
  <button onclick="generateCards()">üé∂ Generate card</button>
  <button onclick="downloadPDF()">üíæ Save to PDF</button>
</div>


<div id="cards"></div>

<script>
async function getSpotifyToken(clientId, clientSecret) {
  const body = new URLSearchParams();
  body.append("grant_type", "client_credentials");
  const res = await fetch("https://accounts.spotify.com/api/token", {
    method: "POST",
    headers: {
      "Authorization": "Basic " + btoa(clientId + ":" + clientSecret),
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body
  });
  const data = await res.json();
  if (!data.access_token) {
    alert("‚ùå Spotify token error. Check your Client ID / Client Secret!");
  }
  return data.access_token;
}

async function fetchTrackData(token, url) {
  const trackIdMatch = url.match(/track\/([A-Za-z0-9]+)/);
  if (!trackIdMatch) return null;
  const trackId = trackIdMatch[1];
  const res = await fetch(`https://api.spotify.com/v1/tracks/${trackId}`, {
    headers: { Authorization: `Bearer ${token}` }
  });
  const data = await res.json();
  const year = data.album?.release_date?.split("-")[0] || "";
  return {
    title: data.name,
    artist: data.artists.map(a => a.name).join(", "),
    year: year,
    link: url
  };
}


async function generateCards() {
  const clientId = document.getElementById("clientId").value.trim();
  const clientSecret = document.getElementById("clientSecret").value.trim();
  if (!clientId || !clientSecret) return alert("No Spotify Client ID / Client Secret!");

  
  localStorage.setItem("spotifyClientId", clientId);
  localStorage.setItem("spotifyClientSecret", clientSecret);

  const token = await getSpotifyToken(clientId, clientSecret);
  if (!token) return;

  const inputs = document.querySelectorAll("#links input");
  const cardsDiv = document.getElementById("cards");
  cardsDiv.innerHTML = "";

  for (let input of inputs) {
    const link = input.value.trim();
    if (!link) continue;

    const trackData = await fetchTrackData(token, link);
    if (!trackData) continue;

    const card = document.createElement("div");
    card.className = "card";

    const qrDiv = document.createElement("div");
    qrDiv.className = "qr";
    new QRCode(qrDiv, { text: trackData.link, width: 128, height: 128 });

    const info = document.createElement("div");
    info.className = "info";
    info.innerHTML = `
      <div class="year">${trackData.year}</div>
      <div class="artist">${trackData.artist}</div>
      <div class="title">${trackData.title}</div>
    `;

    card.appendChild(qrDiv);
    card.appendChild(info);
    cardsDiv.appendChild(card);
  }
}

function downloadPDF() {
  const element = document.getElementById("cards");
  const opt = {
    margin: 0,
    filename: "hitster_cards.pdf",
    image: { type: "jpeg", quality: 1 },
    html2canvas: { scale: 2, useCORS: true, scrollY: 0, backgroundColor: "#ffffff" },
    jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
    pagebreak: { mode: ['avoid'] }
  };

  html2pdf()
    .from(element)
    .set(opt)
    .toPdf()
    .get('pdf')
    .then(pdf => pdf.save('hitster_cards.pdf'));
}

window.addEventListener("DOMContentLoaded", () => {
  const savedId = localStorage.getItem("spotifyClientId");
  const savedSecret = localStorage.getItem("spotifyClientSecret");
  if (savedId) document.getElementById("clientId").value = savedId;
  if (savedSecret) document.getElementById("clientSecret").value = savedSecret;
});
</script>

</body>
</html>








